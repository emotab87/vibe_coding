#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸ” Running pre-commit checks..."

# Frontend checks (if frontend directory exists and has package.json)
if [ -f "frontend/package.json" ]; then
  echo "ðŸ“¦ Checking frontend..."
  cd frontend
  
  # Install dependencies if node_modules doesn't exist
  if [ ! -d "node_modules" ]; then
    echo "ðŸ“¥ Installing frontend dependencies..."
    npm install
  fi
  
  # Run lint-staged for frontend
  npm run pre-commit
  
  # Type checking
  echo "ðŸ” Type checking..."
  npm run type-check
  
  cd ..
fi

# Backend checks (if backend directory exists and has go.mod)
if [ -f "backend/go.mod" ]; then
  echo "ðŸ¹ Checking backend..."
  cd backend
  
  # Format Go code
  echo "ðŸŽ¨ Formatting Go code..."
  go fmt ./...
  
  # Vet Go code
  echo "ðŸ” Vetting Go code..."
  go vet ./...
  
  # Run tests if any exist
  if ls *_test.go >/dev/null 2>&1; then
    echo "ðŸ§ª Running Go tests..."
    go test ./...
  fi
  
  # Try to build
  echo "ðŸ”¨ Building Go code..."
  go build -o /tmp/conduit-build ./cmd/...
  rm -f /tmp/conduit-build
  
  cd ..
fi

echo "âœ… Pre-commit checks completed successfully!"